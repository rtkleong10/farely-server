<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.7.5" />
<title>farely_api.control API documentation</title>
<meta name="description" content="Contains the control classes for the Farely API â€¦" />
<link href='https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css' rel='stylesheet'>
<link href='https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/8.0.0/sanitize.min.css' rel='stylesheet'>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{font-weight:bold}#index h4 + ul{margin-bottom:.6em}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>farely_api.control</code></h1>
</header>
<section id="section-intro">
<p>Contains the control classes for the Farely API.</p>
<p>Handles the application logic for the FarelyAPI</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;Contains the control classes for the Farely API.

Handles the application logic for the FarelyAPI
&#34;&#34;&#34;

from .boundary import GoogleMapsService, DataGovService, LTADataMallService
from .enum import FareType, TravelMode, FareCategory
from .entity import DirectionStep, Location
from abc import abstractmethod

__all__ = [
        &#39;FindRoutesController&#39;,
        &#39;FareControllerFactory&#39;,
        &#39;FareController&#39;,
        &#39;CashFareController&#39;,
        &#39;CardFareController&#39;,
]

class FindRoutesController():
        &#34;&#34;&#34;Processes a route query and returns the best routes from an origin to a destination location.

        Example:
                &gt;&gt;&gt; from farely_api.entity import RouteQuery
                &gt;&gt;&gt; from farely_api.enum import FareType
                &gt;&gt;&gt; from farely_api.control import FindRoutesController

                &gt;&gt;&gt; route_query = RouteQuery(
                ...     fare_type=FareType.ADULT,
                ...     origin=&#34;NTU&#34;,
                ...     destination=&#34;Changi Airport&#34;
                ... )
                &gt;&gt;&gt; routes = FindRoutesController(route_query).find_routes()
                &gt;&gt;&gt; print(routes)
                {&#39;geocoded_waypoints&#39;: [{&#39;geocoder_status&#39;: &#39;OK&#39;, &#39;place_id&#39;: &#39;ChIJY0QBmQoP2jERGYItxQAIu7g&#39;, &#39;types&#39;: [&#39;establishment&#39;, &#39;point_of_interest&#39;, &#39;university&#39;]}, {&#39;geocoder_status&#39;: &#39;OK&#39;, &#39;place_id&#39;: &#39;ChIJ483Qk9YX2jERA0VOQV7d1tY&#39;, &#39;types&#39;: [&#39;airport&#39;, &#39;establishment&#39;, &#39;point_of_interest&#39;]}], &#39;routes&#39;: [...], &#39;status&#39;: &#39;OK&#39;}
        &#34;&#34;&#34;

        def __init__(self, route_query):
                self.__route_query = route_query
                self.__fare_controller = FareControllerFactory.get_fare_controller(self.__route_query.fare_type)

        def get_walking_step(self, step):
                &#34;&#34;&#34;Instantiates `farely_api.entity.DirectionStep` from a walking step of a route.

                Args:
                        step (dict): Dictionary representing a walking step in the Google Maps Direction API Format.

                Returns:
                        direction_step (farely_api.entity.DirectionStep): A `farely_api.entity.DirectionStep` object with attributes of the walking step.
                &#34;&#34;&#34;
                departure_stop = GoogleMapsService.get_location(**step[&#34;start_location&#34;])
                arrival_stop = GoogleMapsService.get_location(**step[&#34;end_location&#34;])
                distance = step[&#34;distance&#34;][&#34;value&#34;] / 1000

                return DirectionStep(
                        travel_mode=TravelMode.WALK,
                        arrival_stop=arrival_stop,
                        departure_stop=departure_stop,
                        distance=distance,
                )

        def get_transit_step(self, step):
                &#34;&#34;&#34;Instantiates `farely_api.entity.DirectionStep` from a walking step of a route.

                Args:
                        step (dict): Dictionary representing a walking step in the Google Maps Direction API Format.

                Returns:
                        direction_step (farely_api.entity.DirectionStep): A `farely_api.entity.DirectionStep` object with attributes of the walking step.
                &#34;&#34;&#34;
                line = step[&#34;transit_details&#34;][&#34;line&#34;][&#34;name&#34;]
                departure_stop = Location(
                        **step[&#34;transit_details&#34;][&#34;departure_stop&#34;][&#34;location&#34;],
                        name=step[&#34;transit_details&#34;][&#34;departure_stop&#34;][&#34;name&#34;],
                )
                arrival_stop = Location(
                        **step[&#34;transit_details&#34;][&#34;arrival_stop&#34;][&#34;location&#34;],
                        name=step[&#34;transit_details&#34;][&#34;arrival_stop&#34;][&#34;name&#34;],
                )
                distance = step[&#34;distance&#34;][&#34;value&#34;] / 1000

                travel_mode = None
                mode = step[&#34;transit_details&#34;][&#34;line&#34;][&#34;vehicle&#34;][&#34;type&#34;]

                if (mode == &#34;SUBWAY&#34;):
                        travel_mode = TravelMode.MRT_LRT
                elif (mode == &#34;BUS&#34;):
                        travel_mode = TravelMode.BUS

                return DirectionStep(
                        line=line,
                        travel_mode=travel_mode,
                        arrival_stop=arrival_stop,
                        departure_stop=departure_stop,
                        distance=distance,
                )

        def get_direction_steps(self, steps):
                &#34;&#34;&#34;Obtains a list of direction steps from a dictionary representing the steps.

                Args:
                        steps (list): List of direction steps of a route in the Google Maps Direction API Format.

                ## Returns
                        direction_steps (list): List of `farely_api.entity.DirectionStep` objects representing the steps of a route.
                &#34;&#34;&#34;
                direction_steps = []

                for step in steps:
                        travel_mode = step[&#34;travel_mode&#34;]
                        if travel_mode == &#34;TRANSIT&#34;:
                                direction_steps.append(self.get_transit_step(step))

                        elif travel_mode == &#34;WALKING&#34;:
                                direction_steps.append(self.get_walking_step(step))

                return direction_steps

        def add_route_details(self, route):
                &#34;&#34;&#34;Adds fare and checkpoint information to a route.

                Checkpoints are created for the departure stop of every step, as well as the endpoint of the last direction step (destination of the route). Checkpoints include the latitude, longitude and name of the checkpoint. For every checkpoint except the last one, the travel_mode is also included using a `farely_api.enum.TravelMode` object.

                Args:
                        route (dict): Route in the Google Maps Direction API Format.
                &#34;&#34;&#34;
                legs = route[&#39;legs&#39;]

                # Each route will always have one leg
                for leg in legs:
                        steps = leg[&#39;steps&#39;]
                        direction_steps = self.get_direction_steps(steps)

                        # Add fare
                        leg[&#39;fare&#39;] = self.__fare_controller.calculate_fare(self.__route_query.fare_type, direction_steps)

                        # Add checkpoint information
                        checkpoints = []

                        # Add checkpoint for departure location of each direction step
                        for direction_step in direction_steps:
                                departure_stop = direction_step.departure_stop

                                checkpoint = {
                                        &#34;lat&#34;: departure_stop.lat,
                                        &#34;lng&#34;: departure_stop.lng,
                                        &#34;name&#34;: departure_stop.name,
                                        &#34;travel_mode&#34;: direction_step.travel_mode,
                                        &#34;line&#34;: direction_step.line,
                                }

                                checkpoints.append(checkpoint)

                        # Add checkpoint for end of route
                        if len(direction_steps) != 0:
                                last_direction_step = direction_steps[-1]
                                endpoint = last_direction_step.arrival_stop

                                checkpoint = {
                                        &#34;lat&#34;: endpoint.lat,
                                        &#34;lng&#34;: endpoint.lng,
                                        &#34;name&#34;: endpoint.name,
                                        &#34;travel_mode&#34;: None,
                                        &#34;line&#34;: &#34;&#34;,
                                }

                                checkpoints.append(checkpoint)

                        leg[&#39;checkpoints&#39;] = checkpoints

        def find_routes(self):
                &#34;&#34;&#34;Processes a route query to find the best routes.

                Uses the Google Maps Direction API to find the routes. Then, it adds fare and checkpoint information to the routes.

                Returns:
                        routes (dict): Dictionary of routes in the Google Maps Direction API Format with fare and checkpoint information embedded.
                &#34;&#34;&#34;
                data = GoogleMapsService.get_directions(
                        origin=self.__route_query.origin,
                        destination=self.__route_query.destination
                )

                routes = data[&#39;routes&#39;]

                for route in routes:
                        self.add_route_details(route)

                return data

class FareControllerFactory():
        &#34;&#34;&#34;Creates different fare controllers.

        It creates `farely_api.control.FareController` objects based on the fare type. Uses the factory pattern to decouple instantiation of the different fare controllers from the client class.
        &#34;&#34;&#34;

        @staticmethod
        def get_fare_controller(fare_type):
                &#34;&#34;&#34;Instanstiates a concrete `farely_api.control.FareController` class based on fare type.

                Args:
                        fare_type (`farely_api.enum.FareType`): The fare type to find the fare controller for.

                Returns:
                        fare_controller (farely_api.control.FareController): An instantiated `farely_api.control.FareController` object. Returns a `farely_api.control.CashFareController` if it&#39;s a single trip fare type, otherwise `farely_api.control.CardFareController`.
                &#34;&#34;&#34;
                if fare_type == FareType.SINGLE_TRIP:
                        return CashFareController()
                else:
                        return CardFareController()

class FareController():
        &#34;&#34;&#34;Calculates the fare of a route.

        It calculates the fare based on the information from Data.gov.sg and LTA DataMall. It also refers to this [pdf](https://www.smrt.com.sg/Portals/0/Journey%20with%20Us/PTC0339_19%20PTC%20Conclusion%20Fare%20Table%20Brochure%20FA.pdf) for more information. This is an abstract class for the fare calculation strategy. It has different concrete fare calculation strategies which are implemented by the subclasses.
        &#34;&#34;&#34;

        def __init__(self):
                self.__fare_table = DataGovService.get_fare_table()
                self.__bus_services = LTADataMallService.get_bus_services()

        def get_bus_type(self, line):
                &#34;&#34;&#34;Obtains the `farely_api.enum.FareCategory` object corresponding to the line of the bus.

                Args:
                        line (str): Line of the bus (bus number).

                Returns:
                        bus_type (farely_api.enum.FareCategory): `farely_api.enum.FareCategory` object corresponding to the line of the bus.
                &#34;&#34;&#34;
                return self.__bus_services.get(line)

        def parse_steps(self, direction_steps):
                &#34;&#34;&#34;Converts a list of `farely_api.entity.DirectionStep` objects into a list of tuples containing the fare category and distance of the directions steps.

                Args:
                        direction_steps (list): List of `farely_api.entity.DirectionStep` objects.

                Returns:
                        direction_steps (list): List of direction steps, where direction steps are represented as a tuple `(fare_category, distance)`.
                &#34;&#34;&#34;
                steps = []

                for step in direction_steps:
                        # Get distance
                        distance = step.distance

                        # Get fare category
                        fare_category = None

                        if step.travel_mode == TravelMode.MRT_LRT:
                                fare_category = FareCategory.MRT_LRT

                        elif step.travel_mode == TravelMode.BUS:
                                fare_category = self.get_bus_type(step.line)

                        elif step.travel_mode == TravelMode.WALK:
                                fare_category = FareCategory.WALK

                        steps.append((fare_category, distance))


                return steps

        def get_step_fare(self, fare_type, fare_category, distance):
                &#34;&#34;&#34;Gets the fare for a step of the route.

                This step may correspond to multiple direction steps that share the same or a similar fare category.

                Args:
                        fare_type (farely_api.enum.FareType): Fare type to calculate the fare for.
                        fare_category (farely_api.enum.FareCategory): Fare category of the step.
                        distance (float): Distance of the step in kilometres.

                Returns:
                        fare (float): Fare for the step in Singapore dollars
                &#34;&#34;&#34;
                if fare_category == FareCategory.WALK or distance == 0:
                        return 0

                if fare_category == None:
                        return None

                distance_fare_table = self.__fare_table.get(fare_category)

                if distance_fare_table == None:
                        return None

                # Find the matching distance range for the distance of the step
                for distance_range in distance_fare_table.keys():
                        if distance &gt;= distance_range[0] and (distance_range[1] == None or distance &lt; distance_range[1]):
                                step_fare = distance_fare_table[distance_range].get(fare_type)

                                if step_fare != None:
                                        return step_fare / 100 # Convert cents to dollars
                                else:
                                        return None

                return None

        def calculate_fare(self, fare_type, direction_steps):
                &#34;&#34;&#34;Call the concrete fare controller class to calculate fare.

                Args:
                        fare_type (farely_api.enum.FareType): Fare type to calculate the fare for.
                        direction_steps (list): List of `farely_api.entity.DirectionStep` objects representing the steps of a route.

                Returns:
                        total_fare (float): Calculated total fare in Singapore dollars.
                &#34;&#34;&#34;
                steps = self.parse_steps(direction_steps)
                total_fare = self.calculate_total_fare(fare_type, steps)
                return total_fare

        @abstractmethod
        def calculate_total_fare(self, fare_type, steps):
                &#34;&#34;&#34;Calculates the fare for a list of direction steps.

                This method is an abstract method to be implemented by the subclass for different concrete strategies.

                Args:
                        fare_type (farely_api.enum.FareType): Fare type to calculate the fare for.
                        steps (list): List of tuples representing the direction steps.

                Returns:
                        fare (float): Calculated fare in Singapore dollars.
                &#34;&#34;&#34;
                pass

class CashFareController(FareController):
        &#34;&#34;&#34;A `farely_api.control.FareController` class for the single trip fare type.

        This class is only for the single trip fare type.
        &#34;&#34;&#34;

        def calculate_total_fare(self, fare_type, steps):
                &#34;&#34;&#34;Calculates the fare for a list of direction steps.

                This method is only for the single trip fare type.

                Args:
                        steps (list): List of tuples representing the direction steps.

                Returns:
                        fare (float): Calculated fare in Singapore dollars.
                &#34;&#34;&#34;
                total_fare = 0
                for step in steps:
                        fare_category = step[0]
                        distance = step[1]
                        current_fare = super().get_step_fare(FareType.SINGLE_TRIP,fare_category, distance)

                        # Return None if one step&#39;s fare can&#39;t be calculated
                        if current_fare == None:
                                return None

                        total_fare += current_fare

                return total_fare

class CardFareController(FareController):
        &#34;&#34;&#34;A `farely_api.control.FareController` subclass for card fare types.

        This class is for fare types other than single trip.
        &#34;&#34;&#34;

        def calculate_total_fare(self, fare_type, steps):
                &#34;&#34;&#34;Calculates the fare for a list of direction steps.

                This method is for fare types other than single trip.

                Args:
                        fare_type (farely_api.enum.FareType): Fare type to calculate the fare for.
                        steps (list): List of tuples representing the direction steps.

                Returns:
                        fare (float): Calculated fare in Singapore dollars.
                &#34;&#34;&#34;
                total_fare = 0
                current_fare_category = None
                current_distance = 0

                # Consecutive MRTs, LRTs &amp; trunk bus fares are counted together as one step in distance fare calculation
                MRT_LRT_GROUP_CATEGORY = [FareCategory.MRT_LRT, FareCategory.TRUNK_BUS]

                for step in steps:
                        fare_category = step[0]
                        distance = step[1]

                        # Check if falls under same category
                        if (fare_category == current_fare_category) or (current_fare_category in MRT_LRT_GROUP_CATEGORY and fare_category in MRT_LRT_GROUP_CATEGORY):
                                current_distance += distance

                        else:
                                current_fare = super().get_step_fare(fare_type, current_fare_category, current_distance)

                                # Return None if one step&#39;s fare can&#39;t be calculated
                                if current_fare == None:
                                        return None

                                total_fare += current_fare

                                current_fare_category = fare_category
                                current_distance = distance

                current_fare = super().get_step_fare(fare_type, current_fare_category, current_distance)

                if current_fare == None:
                        return None

                total_fare += current_fare

                return total_fare</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="farely_api.control.CardFareController"><code class="flex name class">
<span>class <span class="ident">CardFareController</span></span>
</code></dt>
<dd>
<section class="desc"><p>A <a title="farely_api.control.FareController" href="#farely_api.control.FareController"><code>FareController</code></a> subclass for card fare types.</p>
<p>This class is for fare types other than single trip.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class CardFareController(FareController):
        &#34;&#34;&#34;A `farely_api.control.FareController` subclass for card fare types.

        This class is for fare types other than single trip.
        &#34;&#34;&#34;

        def calculate_total_fare(self, fare_type, steps):
                &#34;&#34;&#34;Calculates the fare for a list of direction steps.

                This method is for fare types other than single trip.

                Args:
                        fare_type (farely_api.enum.FareType): Fare type to calculate the fare for.
                        steps (list): List of tuples representing the direction steps.

                Returns:
                        fare (float): Calculated fare in Singapore dollars.
                &#34;&#34;&#34;
                total_fare = 0
                current_fare_category = None
                current_distance = 0

                # Consecutive MRTs, LRTs &amp; trunk bus fares are counted together as one step in distance fare calculation
                MRT_LRT_GROUP_CATEGORY = [FareCategory.MRT_LRT, FareCategory.TRUNK_BUS]

                for step in steps:
                        fare_category = step[0]
                        distance = step[1]

                        # Check if falls under same category
                        if (fare_category == current_fare_category) or (current_fare_category in MRT_LRT_GROUP_CATEGORY and fare_category in MRT_LRT_GROUP_CATEGORY):
                                current_distance += distance

                        else:
                                current_fare = super().get_step_fare(fare_type, current_fare_category, current_distance)

                                # Return None if one step&#39;s fare can&#39;t be calculated
                                if current_fare == None:
                                        return None

                                total_fare += current_fare

                                current_fare_category = fare_category
                                current_distance = distance

                current_fare = super().get_step_fare(fare_type, current_fare_category, current_distance)

                if current_fare == None:
                        return None

                total_fare += current_fare

                return total_fare</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="farely_api.control.FareController" href="#farely_api.control.FareController">FareController</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="farely_api.control.CardFareController.calculate_total_fare"><code class="name flex">
<span>def <span class="ident">calculate_total_fare</span></span>(<span>self, fare_type, steps)</span>
</code></dt>
<dd>
<section class="desc"><p>Calculates the fare for a list of direction steps.</p>
<p>This method is for fare types other than single trip.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>fare_type</code></strong> :&ensp;<a title="farely_api.enum.FareType" href="enum.html#farely_api.enum.FareType"><code>FareType</code></a></dt>
<dd>Fare type to calculate the fare for.</dd>
<dt><strong><code>steps</code></strong> :&ensp;<code>list</code></dt>
<dd>List of tuples representing the direction steps.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>fare</code></strong> :&ensp;<code>float</code></dt>
<dd>Calculated fare in Singapore dollars.</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def calculate_total_fare(self, fare_type, steps):
        &#34;&#34;&#34;Calculates the fare for a list of direction steps.

        This method is for fare types other than single trip.

        Args:
                fare_type (farely_api.enum.FareType): Fare type to calculate the fare for.
                steps (list): List of tuples representing the direction steps.

        Returns:
                fare (float): Calculated fare in Singapore dollars.
        &#34;&#34;&#34;
        total_fare = 0
        current_fare_category = None
        current_distance = 0

        # Consecutive MRTs, LRTs &amp; trunk bus fares are counted together as one step in distance fare calculation
        MRT_LRT_GROUP_CATEGORY = [FareCategory.MRT_LRT, FareCategory.TRUNK_BUS]

        for step in steps:
                fare_category = step[0]
                distance = step[1]

                # Check if falls under same category
                if (fare_category == current_fare_category) or (current_fare_category in MRT_LRT_GROUP_CATEGORY and fare_category in MRT_LRT_GROUP_CATEGORY):
                        current_distance += distance

                else:
                        current_fare = super().get_step_fare(fare_type, current_fare_category, current_distance)

                        # Return None if one step&#39;s fare can&#39;t be calculated
                        if current_fare == None:
                                return None

                        total_fare += current_fare

                        current_fare_category = fare_category
                        current_distance = distance

        current_fare = super().get_step_fare(fare_type, current_fare_category, current_distance)

        if current_fare == None:
                return None

        total_fare += current_fare

        return total_fare</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="farely_api.control.FareController" href="#farely_api.control.FareController">FareController</a></b></code>:
<ul class="hlist">
<li><code><a title="farely_api.control.FareController.calculate_fare" href="#farely_api.control.FareController.calculate_fare">calculate_fare</a></code></li>
<li><code><a title="farely_api.control.FareController.get_bus_type" href="#farely_api.control.FareController.get_bus_type">get_bus_type</a></code></li>
<li><code><a title="farely_api.control.FareController.get_step_fare" href="#farely_api.control.FareController.get_step_fare">get_step_fare</a></code></li>
<li><code><a title="farely_api.control.FareController.parse_steps" href="#farely_api.control.FareController.parse_steps">parse_steps</a></code></li>
</ul>
</li>
</ul>
</dd>
<dt id="farely_api.control.CashFareController"><code class="flex name class">
<span>class <span class="ident">CashFareController</span></span>
</code></dt>
<dd>
<section class="desc"><p>A <a title="farely_api.control.FareController" href="#farely_api.control.FareController"><code>FareController</code></a> class for the single trip fare type.</p>
<p>This class is only for the single trip fare type.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class CashFareController(FareController):
        &#34;&#34;&#34;A `farely_api.control.FareController` class for the single trip fare type.

        This class is only for the single trip fare type.
        &#34;&#34;&#34;

        def calculate_total_fare(self, fare_type, steps):
                &#34;&#34;&#34;Calculates the fare for a list of direction steps.

                This method is only for the single trip fare type.

                Args:
                        steps (list): List of tuples representing the direction steps.

                Returns:
                        fare (float): Calculated fare in Singapore dollars.
                &#34;&#34;&#34;
                total_fare = 0
                for step in steps:
                        fare_category = step[0]
                        distance = step[1]
                        current_fare = super().get_step_fare(FareType.SINGLE_TRIP,fare_category, distance)

                        # Return None if one step&#39;s fare can&#39;t be calculated
                        if current_fare == None:
                                return None

                        total_fare += current_fare

                return total_fare</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="farely_api.control.FareController" href="#farely_api.control.FareController">FareController</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="farely_api.control.CashFareController.calculate_total_fare"><code class="name flex">
<span>def <span class="ident">calculate_total_fare</span></span>(<span>self, fare_type, steps)</span>
</code></dt>
<dd>
<section class="desc"><p>Calculates the fare for a list of direction steps.</p>
<p>This method is only for the single trip fare type.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>steps</code></strong> :&ensp;<code>list</code></dt>
<dd>List of tuples representing the direction steps.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>fare</code></strong> :&ensp;<code>float</code></dt>
<dd>Calculated fare in Singapore dollars.</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def calculate_total_fare(self, fare_type, steps):
        &#34;&#34;&#34;Calculates the fare for a list of direction steps.

        This method is only for the single trip fare type.

        Args:
                steps (list): List of tuples representing the direction steps.

        Returns:
                fare (float): Calculated fare in Singapore dollars.
        &#34;&#34;&#34;
        total_fare = 0
        for step in steps:
                fare_category = step[0]
                distance = step[1]
                current_fare = super().get_step_fare(FareType.SINGLE_TRIP,fare_category, distance)

                # Return None if one step&#39;s fare can&#39;t be calculated
                if current_fare == None:
                        return None

                total_fare += current_fare

        return total_fare</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="farely_api.control.FareController" href="#farely_api.control.FareController">FareController</a></b></code>:
<ul class="hlist">
<li><code><a title="farely_api.control.FareController.calculate_fare" href="#farely_api.control.FareController.calculate_fare">calculate_fare</a></code></li>
<li><code><a title="farely_api.control.FareController.get_bus_type" href="#farely_api.control.FareController.get_bus_type">get_bus_type</a></code></li>
<li><code><a title="farely_api.control.FareController.get_step_fare" href="#farely_api.control.FareController.get_step_fare">get_step_fare</a></code></li>
<li><code><a title="farely_api.control.FareController.parse_steps" href="#farely_api.control.FareController.parse_steps">parse_steps</a></code></li>
</ul>
</li>
</ul>
</dd>
<dt id="farely_api.control.FareController"><code class="flex name class">
<span>class <span class="ident">FareController</span></span>
</code></dt>
<dd>
<section class="desc"><p>Calculates the fare of a route.</p>
<p>It calculates the fare based on the information from Data.gov.sg and LTA DataMall. It also refers to this <a href="https://www.smrt.com.sg/Portals/0/Journey%20with%20Us/PTC0339_19%20PTC%20Conclusion%20Fare%20Table%20Brochure%20FA.pdf">pdf</a> for more information. This is an abstract class for the fare calculation strategy. It has different concrete fare calculation strategies which are implemented by the subclasses.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class FareController():
        &#34;&#34;&#34;Calculates the fare of a route.

        It calculates the fare based on the information from Data.gov.sg and LTA DataMall. It also refers to this [pdf](https://www.smrt.com.sg/Portals/0/Journey%20with%20Us/PTC0339_19%20PTC%20Conclusion%20Fare%20Table%20Brochure%20FA.pdf) for more information. This is an abstract class for the fare calculation strategy. It has different concrete fare calculation strategies which are implemented by the subclasses.
        &#34;&#34;&#34;

        def __init__(self):
                self.__fare_table = DataGovService.get_fare_table()
                self.__bus_services = LTADataMallService.get_bus_services()

        def get_bus_type(self, line):
                &#34;&#34;&#34;Obtains the `farely_api.enum.FareCategory` object corresponding to the line of the bus.

                Args:
                        line (str): Line of the bus (bus number).

                Returns:
                        bus_type (farely_api.enum.FareCategory): `farely_api.enum.FareCategory` object corresponding to the line of the bus.
                &#34;&#34;&#34;
                return self.__bus_services.get(line)

        def parse_steps(self, direction_steps):
                &#34;&#34;&#34;Converts a list of `farely_api.entity.DirectionStep` objects into a list of tuples containing the fare category and distance of the directions steps.

                Args:
                        direction_steps (list): List of `farely_api.entity.DirectionStep` objects.

                Returns:
                        direction_steps (list): List of direction steps, where direction steps are represented as a tuple `(fare_category, distance)`.
                &#34;&#34;&#34;
                steps = []

                for step in direction_steps:
                        # Get distance
                        distance = step.distance

                        # Get fare category
                        fare_category = None

                        if step.travel_mode == TravelMode.MRT_LRT:
                                fare_category = FareCategory.MRT_LRT

                        elif step.travel_mode == TravelMode.BUS:
                                fare_category = self.get_bus_type(step.line)

                        elif step.travel_mode == TravelMode.WALK:
                                fare_category = FareCategory.WALK

                        steps.append((fare_category, distance))


                return steps

        def get_step_fare(self, fare_type, fare_category, distance):
                &#34;&#34;&#34;Gets the fare for a step of the route.

                This step may correspond to multiple direction steps that share the same or a similar fare category.

                Args:
                        fare_type (farely_api.enum.FareType): Fare type to calculate the fare for.
                        fare_category (farely_api.enum.FareCategory): Fare category of the step.
                        distance (float): Distance of the step in kilometres.

                Returns:
                        fare (float): Fare for the step in Singapore dollars
                &#34;&#34;&#34;
                if fare_category == FareCategory.WALK or distance == 0:
                        return 0

                if fare_category == None:
                        return None

                distance_fare_table = self.__fare_table.get(fare_category)

                if distance_fare_table == None:
                        return None

                # Find the matching distance range for the distance of the step
                for distance_range in distance_fare_table.keys():
                        if distance &gt;= distance_range[0] and (distance_range[1] == None or distance &lt; distance_range[1]):
                                step_fare = distance_fare_table[distance_range].get(fare_type)

                                if step_fare != None:
                                        return step_fare / 100 # Convert cents to dollars
                                else:
                                        return None

                return None

        def calculate_fare(self, fare_type, direction_steps):
                &#34;&#34;&#34;Call the concrete fare controller class to calculate fare.

                Args:
                        fare_type (farely_api.enum.FareType): Fare type to calculate the fare for.
                        direction_steps (list): List of `farely_api.entity.DirectionStep` objects representing the steps of a route.

                Returns:
                        total_fare (float): Calculated total fare in Singapore dollars.
                &#34;&#34;&#34;
                steps = self.parse_steps(direction_steps)
                total_fare = self.calculate_total_fare(fare_type, steps)
                return total_fare

        @abstractmethod
        def calculate_total_fare(self, fare_type, steps):
                &#34;&#34;&#34;Calculates the fare for a list of direction steps.

                This method is an abstract method to be implemented by the subclass for different concrete strategies.

                Args:
                        fare_type (farely_api.enum.FareType): Fare type to calculate the fare for.
                        steps (list): List of tuples representing the direction steps.

                Returns:
                        fare (float): Calculated fare in Singapore dollars.
                &#34;&#34;&#34;
                pass</code></pre>
</details>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="farely_api.control.CardFareController" href="#farely_api.control.CardFareController">CardFareController</a></li>
<li><a title="farely_api.control.CashFareController" href="#farely_api.control.CashFareController">CashFareController</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="farely_api.control.FareController.calculate_fare"><code class="name flex">
<span>def <span class="ident">calculate_fare</span></span>(<span>self, fare_type, direction_steps)</span>
</code></dt>
<dd>
<section class="desc"><p>Call the concrete fare controller class to calculate fare.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>fare_type</code></strong> :&ensp;<a title="farely_api.enum.FareType" href="enum.html#farely_api.enum.FareType"><code>FareType</code></a></dt>
<dd>Fare type to calculate the fare for.</dd>
<dt><strong><code>direction_steps</code></strong> :&ensp;<code>list</code></dt>
<dd>List of <a title="farely_api.entity.DirectionStep" href="entity.html#farely_api.entity.DirectionStep"><code>DirectionStep</code></a> objects representing the steps of a route.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>total_fare</code></strong> :&ensp;<code>float</code></dt>
<dd>Calculated total fare in Singapore dollars.</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def calculate_fare(self, fare_type, direction_steps):
        &#34;&#34;&#34;Call the concrete fare controller class to calculate fare.

        Args:
                fare_type (farely_api.enum.FareType): Fare type to calculate the fare for.
                direction_steps (list): List of `farely_api.entity.DirectionStep` objects representing the steps of a route.

        Returns:
                total_fare (float): Calculated total fare in Singapore dollars.
        &#34;&#34;&#34;
        steps = self.parse_steps(direction_steps)
        total_fare = self.calculate_total_fare(fare_type, steps)
        return total_fare</code></pre>
</details>
</dd>
<dt id="farely_api.control.FareController.calculate_total_fare"><code class="name flex">
<span>def <span class="ident">calculate_total_fare</span></span>(<span>self, fare_type, steps)</span>
</code></dt>
<dd>
<section class="desc"><p>Calculates the fare for a list of direction steps.</p>
<p>This method is an abstract method to be implemented by the subclass for different concrete strategies.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>fare_type</code></strong> :&ensp;<a title="farely_api.enum.FareType" href="enum.html#farely_api.enum.FareType"><code>FareType</code></a></dt>
<dd>Fare type to calculate the fare for.</dd>
<dt><strong><code>steps</code></strong> :&ensp;<code>list</code></dt>
<dd>List of tuples representing the direction steps.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>fare</code></strong> :&ensp;<code>float</code></dt>
<dd>Calculated fare in Singapore dollars.</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@abstractmethod
def calculate_total_fare(self, fare_type, steps):
        &#34;&#34;&#34;Calculates the fare for a list of direction steps.

        This method is an abstract method to be implemented by the subclass for different concrete strategies.

        Args:
                fare_type (farely_api.enum.FareType): Fare type to calculate the fare for.
                steps (list): List of tuples representing the direction steps.

        Returns:
                fare (float): Calculated fare in Singapore dollars.
        &#34;&#34;&#34;
        pass</code></pre>
</details>
</dd>
<dt id="farely_api.control.FareController.get_bus_type"><code class="name flex">
<span>def <span class="ident">get_bus_type</span></span>(<span>self, line)</span>
</code></dt>
<dd>
<section class="desc"><p>Obtains the <a title="farely_api.enum.FareCategory" href="enum.html#farely_api.enum.FareCategory"><code>FareCategory</code></a> object corresponding to the line of the bus.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>line</code></strong> :&ensp;<code>str</code></dt>
<dd>Line of the bus (bus number).</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>bus_type</code></strong> :&ensp;<a title="farely_api.enum.FareCategory" href="enum.html#farely_api.enum.FareCategory"><code>FareCategory</code></a></dt>
<dd><a title="farely_api.enum.FareCategory" href="enum.html#farely_api.enum.FareCategory"><code>FareCategory</code></a> object corresponding to the line of the bus.</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_bus_type(self, line):
        &#34;&#34;&#34;Obtains the `farely_api.enum.FareCategory` object corresponding to the line of the bus.

        Args:
                line (str): Line of the bus (bus number).

        Returns:
                bus_type (farely_api.enum.FareCategory): `farely_api.enum.FareCategory` object corresponding to the line of the bus.
        &#34;&#34;&#34;
        return self.__bus_services.get(line)</code></pre>
</details>
</dd>
<dt id="farely_api.control.FareController.get_step_fare"><code class="name flex">
<span>def <span class="ident">get_step_fare</span></span>(<span>self, fare_type, fare_category, distance)</span>
</code></dt>
<dd>
<section class="desc"><p>Gets the fare for a step of the route.</p>
<p>This step may correspond to multiple direction steps that share the same or a similar fare category.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>fare_type</code></strong> :&ensp;<a title="farely_api.enum.FareType" href="enum.html#farely_api.enum.FareType"><code>FareType</code></a></dt>
<dd>Fare type to calculate the fare for.</dd>
<dt><strong><code>fare_category</code></strong> :&ensp;<a title="farely_api.enum.FareCategory" href="enum.html#farely_api.enum.FareCategory"><code>FareCategory</code></a></dt>
<dd>Fare category of the step.</dd>
<dt><strong><code>distance</code></strong> :&ensp;<code>float</code></dt>
<dd>Distance of the step in kilometres.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>fare</code></strong> :&ensp;<code>float</code></dt>
<dd>Fare for the step in Singapore dollars</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_step_fare(self, fare_type, fare_category, distance):
        &#34;&#34;&#34;Gets the fare for a step of the route.

        This step may correspond to multiple direction steps that share the same or a similar fare category.

        Args:
                fare_type (farely_api.enum.FareType): Fare type to calculate the fare for.
                fare_category (farely_api.enum.FareCategory): Fare category of the step.
                distance (float): Distance of the step in kilometres.

        Returns:
                fare (float): Fare for the step in Singapore dollars
        &#34;&#34;&#34;
        if fare_category == FareCategory.WALK or distance == 0:
                return 0

        if fare_category == None:
                return None

        distance_fare_table = self.__fare_table.get(fare_category)

        if distance_fare_table == None:
                return None

        # Find the matching distance range for the distance of the step
        for distance_range in distance_fare_table.keys():
                if distance &gt;= distance_range[0] and (distance_range[1] == None or distance &lt; distance_range[1]):
                        step_fare = distance_fare_table[distance_range].get(fare_type)

                        if step_fare != None:
                                return step_fare / 100 # Convert cents to dollars
                        else:
                                return None

        return None</code></pre>
</details>
</dd>
<dt id="farely_api.control.FareController.parse_steps"><code class="name flex">
<span>def <span class="ident">parse_steps</span></span>(<span>self, direction_steps)</span>
</code></dt>
<dd>
<section class="desc"><p>Converts a list of <a title="farely_api.entity.DirectionStep" href="entity.html#farely_api.entity.DirectionStep"><code>DirectionStep</code></a> objects into a list of tuples containing the fare category and distance of the directions steps.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>direction_steps</code></strong> :&ensp;<code>list</code></dt>
<dd>List of <a title="farely_api.entity.DirectionStep" href="entity.html#farely_api.entity.DirectionStep"><code>DirectionStep</code></a> objects.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>direction_steps</code></strong> :&ensp;<code>list</code></dt>
<dd>List of direction steps, where direction steps are represented as a tuple <code>(fare_category, distance)</code>.</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def parse_steps(self, direction_steps):
        &#34;&#34;&#34;Converts a list of `farely_api.entity.DirectionStep` objects into a list of tuples containing the fare category and distance of the directions steps.

        Args:
                direction_steps (list): List of `farely_api.entity.DirectionStep` objects.

        Returns:
                direction_steps (list): List of direction steps, where direction steps are represented as a tuple `(fare_category, distance)`.
        &#34;&#34;&#34;
        steps = []

        for step in direction_steps:
                # Get distance
                distance = step.distance

                # Get fare category
                fare_category = None

                if step.travel_mode == TravelMode.MRT_LRT:
                        fare_category = FareCategory.MRT_LRT

                elif step.travel_mode == TravelMode.BUS:
                        fare_category = self.get_bus_type(step.line)

                elif step.travel_mode == TravelMode.WALK:
                        fare_category = FareCategory.WALK

                steps.append((fare_category, distance))


        return steps</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="farely_api.control.FareControllerFactory"><code class="flex name class">
<span>class <span class="ident">FareControllerFactory</span></span>
</code></dt>
<dd>
<section class="desc"><p>Creates different fare controllers.</p>
<p>It creates <a title="farely_api.control.FareController" href="#farely_api.control.FareController"><code>FareController</code></a> objects based on the fare type. Uses the factory pattern to decouple instantiation of the different fare controllers from the client class.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class FareControllerFactory():
        &#34;&#34;&#34;Creates different fare controllers.

        It creates `farely_api.control.FareController` objects based on the fare type. Uses the factory pattern to decouple instantiation of the different fare controllers from the client class.
        &#34;&#34;&#34;

        @staticmethod
        def get_fare_controller(fare_type):
                &#34;&#34;&#34;Instanstiates a concrete `farely_api.control.FareController` class based on fare type.

                Args:
                        fare_type (`farely_api.enum.FareType`): The fare type to find the fare controller for.

                Returns:
                        fare_controller (farely_api.control.FareController): An instantiated `farely_api.control.FareController` object. Returns a `farely_api.control.CashFareController` if it&#39;s a single trip fare type, otherwise `farely_api.control.CardFareController`.
                &#34;&#34;&#34;
                if fare_type == FareType.SINGLE_TRIP:
                        return CashFareController()
                else:
                        return CardFareController()</code></pre>
</details>
<h3>Static methods</h3>
<dl>
<dt id="farely_api.control.FareControllerFactory.get_fare_controller"><code class="name flex">
<span>def <span class="ident">get_fare_controller</span></span>(<span>fare_type)</span>
</code></dt>
<dd>
<section class="desc"><p>Instanstiates a concrete <a title="farely_api.control.FareController" href="#farely_api.control.FareController"><code>FareController</code></a> class based on fare type.</p>
<h2 id="args">Args</h2>
<p>fare_type (<a title="farely_api.enum.FareType" href="enum.html#farely_api.enum.FareType"><code>FareType</code></a>): The fare type to find the fare controller for.</p>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>fare_controller</code></strong> :&ensp;<a title="farely_api.control.FareController" href="#farely_api.control.FareController"><code>FareController</code></a></dt>
<dd>An instantiated <a title="farely_api.control.FareController" href="#farely_api.control.FareController"><code>FareController</code></a> object. Returns a <a title="farely_api.control.CashFareController" href="#farely_api.control.CashFareController"><code>CashFareController</code></a> if it's a single trip fare type, otherwise <a title="farely_api.control.CardFareController" href="#farely_api.control.CardFareController"><code>CardFareController</code></a>.</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def get_fare_controller(fare_type):
        &#34;&#34;&#34;Instanstiates a concrete `farely_api.control.FareController` class based on fare type.

        Args:
                fare_type (`farely_api.enum.FareType`): The fare type to find the fare controller for.

        Returns:
                fare_controller (farely_api.control.FareController): An instantiated `farely_api.control.FareController` object. Returns a `farely_api.control.CashFareController` if it&#39;s a single trip fare type, otherwise `farely_api.control.CardFareController`.
        &#34;&#34;&#34;
        if fare_type == FareType.SINGLE_TRIP:
                return CashFareController()
        else:
                return CardFareController()</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="farely_api.control.FindRoutesController"><code class="flex name class">
<span>class <span class="ident">FindRoutesController</span></span>
<span>(</span><span>route_query)</span>
</code></dt>
<dd>
<section class="desc"><p>Processes a route query and returns the best routes from an origin to a destination location.</p>
<h2 id="example">Example</h2>
<pre><code>&gt;&gt;&gt; from farely_api.entity import RouteQuery
&gt;&gt;&gt; from farely_api.enum import FareType
&gt;&gt;&gt; from farely_api.control import FindRoutesController

&gt;&gt;&gt; route_query = RouteQuery(
...     fare_type=FareType.ADULT,
...     origin="NTU",
...     destination="Changi Airport"
... )
&gt;&gt;&gt; routes = FindRoutesController(route_query).find_routes()
&gt;&gt;&gt; print(routes)
{'geocoded_waypoints': [{'geocoder_status': 'OK', 'place_id': 'ChIJY0QBmQoP2jERGYItxQAIu7g', 'types': ['establishment', 'point_of_interest', 'university']}, {'geocoder_status': 'OK', 'place_id': 'ChIJ483Qk9YX2jERA0VOQV7d1tY', 'types': ['airport', 'establishment', 'point_of_interest']}], 'routes': [...], 'status': 'OK'}
</code></pre></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class FindRoutesController():
        &#34;&#34;&#34;Processes a route query and returns the best routes from an origin to a destination location.

        Example:
                &gt;&gt;&gt; from farely_api.entity import RouteQuery
                &gt;&gt;&gt; from farely_api.enum import FareType
                &gt;&gt;&gt; from farely_api.control import FindRoutesController

                &gt;&gt;&gt; route_query = RouteQuery(
                ...     fare_type=FareType.ADULT,
                ...     origin=&#34;NTU&#34;,
                ...     destination=&#34;Changi Airport&#34;
                ... )
                &gt;&gt;&gt; routes = FindRoutesController(route_query).find_routes()
                &gt;&gt;&gt; print(routes)
                {&#39;geocoded_waypoints&#39;: [{&#39;geocoder_status&#39;: &#39;OK&#39;, &#39;place_id&#39;: &#39;ChIJY0QBmQoP2jERGYItxQAIu7g&#39;, &#39;types&#39;: [&#39;establishment&#39;, &#39;point_of_interest&#39;, &#39;university&#39;]}, {&#39;geocoder_status&#39;: &#39;OK&#39;, &#39;place_id&#39;: &#39;ChIJ483Qk9YX2jERA0VOQV7d1tY&#39;, &#39;types&#39;: [&#39;airport&#39;, &#39;establishment&#39;, &#39;point_of_interest&#39;]}], &#39;routes&#39;: [...], &#39;status&#39;: &#39;OK&#39;}
        &#34;&#34;&#34;

        def __init__(self, route_query):
                self.__route_query = route_query
                self.__fare_controller = FareControllerFactory.get_fare_controller(self.__route_query.fare_type)

        def get_walking_step(self, step):
                &#34;&#34;&#34;Instantiates `farely_api.entity.DirectionStep` from a walking step of a route.

                Args:
                        step (dict): Dictionary representing a walking step in the Google Maps Direction API Format.

                Returns:
                        direction_step (farely_api.entity.DirectionStep): A `farely_api.entity.DirectionStep` object with attributes of the walking step.
                &#34;&#34;&#34;
                departure_stop = GoogleMapsService.get_location(**step[&#34;start_location&#34;])
                arrival_stop = GoogleMapsService.get_location(**step[&#34;end_location&#34;])
                distance = step[&#34;distance&#34;][&#34;value&#34;] / 1000

                return DirectionStep(
                        travel_mode=TravelMode.WALK,
                        arrival_stop=arrival_stop,
                        departure_stop=departure_stop,
                        distance=distance,
                )

        def get_transit_step(self, step):
                &#34;&#34;&#34;Instantiates `farely_api.entity.DirectionStep` from a walking step of a route.

                Args:
                        step (dict): Dictionary representing a walking step in the Google Maps Direction API Format.

                Returns:
                        direction_step (farely_api.entity.DirectionStep): A `farely_api.entity.DirectionStep` object with attributes of the walking step.
                &#34;&#34;&#34;
                line = step[&#34;transit_details&#34;][&#34;line&#34;][&#34;name&#34;]
                departure_stop = Location(
                        **step[&#34;transit_details&#34;][&#34;departure_stop&#34;][&#34;location&#34;],
                        name=step[&#34;transit_details&#34;][&#34;departure_stop&#34;][&#34;name&#34;],
                )
                arrival_stop = Location(
                        **step[&#34;transit_details&#34;][&#34;arrival_stop&#34;][&#34;location&#34;],
                        name=step[&#34;transit_details&#34;][&#34;arrival_stop&#34;][&#34;name&#34;],
                )
                distance = step[&#34;distance&#34;][&#34;value&#34;] / 1000

                travel_mode = None
                mode = step[&#34;transit_details&#34;][&#34;line&#34;][&#34;vehicle&#34;][&#34;type&#34;]

                if (mode == &#34;SUBWAY&#34;):
                        travel_mode = TravelMode.MRT_LRT
                elif (mode == &#34;BUS&#34;):
                        travel_mode = TravelMode.BUS

                return DirectionStep(
                        line=line,
                        travel_mode=travel_mode,
                        arrival_stop=arrival_stop,
                        departure_stop=departure_stop,
                        distance=distance,
                )

        def get_direction_steps(self, steps):
                &#34;&#34;&#34;Obtains a list of direction steps from a dictionary representing the steps.

                Args:
                        steps (list): List of direction steps of a route in the Google Maps Direction API Format.

                ## Returns
                        direction_steps (list): List of `farely_api.entity.DirectionStep` objects representing the steps of a route.
                &#34;&#34;&#34;
                direction_steps = []

                for step in steps:
                        travel_mode = step[&#34;travel_mode&#34;]
                        if travel_mode == &#34;TRANSIT&#34;:
                                direction_steps.append(self.get_transit_step(step))

                        elif travel_mode == &#34;WALKING&#34;:
                                direction_steps.append(self.get_walking_step(step))

                return direction_steps

        def add_route_details(self, route):
                &#34;&#34;&#34;Adds fare and checkpoint information to a route.

                Checkpoints are created for the departure stop of every step, as well as the endpoint of the last direction step (destination of the route). Checkpoints include the latitude, longitude and name of the checkpoint. For every checkpoint except the last one, the travel_mode is also included using a `farely_api.enum.TravelMode` object.

                Args:
                        route (dict): Route in the Google Maps Direction API Format.
                &#34;&#34;&#34;
                legs = route[&#39;legs&#39;]

                # Each route will always have one leg
                for leg in legs:
                        steps = leg[&#39;steps&#39;]
                        direction_steps = self.get_direction_steps(steps)

                        # Add fare
                        leg[&#39;fare&#39;] = self.__fare_controller.calculate_fare(self.__route_query.fare_type, direction_steps)

                        # Add checkpoint information
                        checkpoints = []

                        # Add checkpoint for departure location of each direction step
                        for direction_step in direction_steps:
                                departure_stop = direction_step.departure_stop

                                checkpoint = {
                                        &#34;lat&#34;: departure_stop.lat,
                                        &#34;lng&#34;: departure_stop.lng,
                                        &#34;name&#34;: departure_stop.name,
                                        &#34;travel_mode&#34;: direction_step.travel_mode,
                                        &#34;line&#34;: direction_step.line,
                                }

                                checkpoints.append(checkpoint)

                        # Add checkpoint for end of route
                        if len(direction_steps) != 0:
                                last_direction_step = direction_steps[-1]
                                endpoint = last_direction_step.arrival_stop

                                checkpoint = {
                                        &#34;lat&#34;: endpoint.lat,
                                        &#34;lng&#34;: endpoint.lng,
                                        &#34;name&#34;: endpoint.name,
                                        &#34;travel_mode&#34;: None,
                                        &#34;line&#34;: &#34;&#34;,
                                }

                                checkpoints.append(checkpoint)

                        leg[&#39;checkpoints&#39;] = checkpoints

        def find_routes(self):
                &#34;&#34;&#34;Processes a route query to find the best routes.

                Uses the Google Maps Direction API to find the routes. Then, it adds fare and checkpoint information to the routes.

                Returns:
                        routes (dict): Dictionary of routes in the Google Maps Direction API Format with fare and checkpoint information embedded.
                &#34;&#34;&#34;
                data = GoogleMapsService.get_directions(
                        origin=self.__route_query.origin,
                        destination=self.__route_query.destination
                )

                routes = data[&#39;routes&#39;]

                for route in routes:
                        self.add_route_details(route)

                return data</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="farely_api.control.FindRoutesController.add_route_details"><code class="name flex">
<span>def <span class="ident">add_route_details</span></span>(<span>self, route)</span>
</code></dt>
<dd>
<section class="desc"><p>Adds fare and checkpoint information to a route.</p>
<p>Checkpoints are created for the departure stop of every step, as well as the endpoint of the last direction step (destination of the route). Checkpoints include the latitude, longitude and name of the checkpoint. For every checkpoint except the last one, the travel_mode is also included using a <a title="farely_api.enum.TravelMode" href="enum.html#farely_api.enum.TravelMode"><code>TravelMode</code></a> object.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>route</code></strong> :&ensp;<code>dict</code></dt>
<dd>Route in the Google Maps Direction API Format.</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add_route_details(self, route):
        &#34;&#34;&#34;Adds fare and checkpoint information to a route.

        Checkpoints are created for the departure stop of every step, as well as the endpoint of the last direction step (destination of the route). Checkpoints include the latitude, longitude and name of the checkpoint. For every checkpoint except the last one, the travel_mode is also included using a `farely_api.enum.TravelMode` object.

        Args:
                route (dict): Route in the Google Maps Direction API Format.
        &#34;&#34;&#34;
        legs = route[&#39;legs&#39;]

        # Each route will always have one leg
        for leg in legs:
                steps = leg[&#39;steps&#39;]
                direction_steps = self.get_direction_steps(steps)

                # Add fare
                leg[&#39;fare&#39;] = self.__fare_controller.calculate_fare(self.__route_query.fare_type, direction_steps)

                # Add checkpoint information
                checkpoints = []

                # Add checkpoint for departure location of each direction step
                for direction_step in direction_steps:
                        departure_stop = direction_step.departure_stop

                        checkpoint = {
                                &#34;lat&#34;: departure_stop.lat,
                                &#34;lng&#34;: departure_stop.lng,
                                &#34;name&#34;: departure_stop.name,
                                &#34;travel_mode&#34;: direction_step.travel_mode,
                                &#34;line&#34;: direction_step.line,
                        }

                        checkpoints.append(checkpoint)

                # Add checkpoint for end of route
                if len(direction_steps) != 0:
                        last_direction_step = direction_steps[-1]
                        endpoint = last_direction_step.arrival_stop

                        checkpoint = {
                                &#34;lat&#34;: endpoint.lat,
                                &#34;lng&#34;: endpoint.lng,
                                &#34;name&#34;: endpoint.name,
                                &#34;travel_mode&#34;: None,
                                &#34;line&#34;: &#34;&#34;,
                        }

                        checkpoints.append(checkpoint)

                leg[&#39;checkpoints&#39;] = checkpoints</code></pre>
</details>
</dd>
<dt id="farely_api.control.FindRoutesController.find_routes"><code class="name flex">
<span>def <span class="ident">find_routes</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>Processes a route query to find the best routes.</p>
<p>Uses the Google Maps Direction API to find the routes. Then, it adds fare and checkpoint information to the routes.</p>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>routes</code></strong> :&ensp;<code>dict</code></dt>
<dd>Dictionary of routes in the Google Maps Direction API Format with fare and checkpoint information embedded.</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def find_routes(self):
        &#34;&#34;&#34;Processes a route query to find the best routes.

        Uses the Google Maps Direction API to find the routes. Then, it adds fare and checkpoint information to the routes.

        Returns:
                routes (dict): Dictionary of routes in the Google Maps Direction API Format with fare and checkpoint information embedded.
        &#34;&#34;&#34;
        data = GoogleMapsService.get_directions(
                origin=self.__route_query.origin,
                destination=self.__route_query.destination
        )

        routes = data[&#39;routes&#39;]

        for route in routes:
                self.add_route_details(route)

        return data</code></pre>
</details>
</dd>
<dt id="farely_api.control.FindRoutesController.get_direction_steps"><code class="name flex">
<span>def <span class="ident">get_direction_steps</span></span>(<span>self, steps)</span>
</code></dt>
<dd>
<section class="desc"><p>Obtains a list of direction steps from a dictionary representing the steps.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>steps</code></strong> :&ensp;<code>list</code></dt>
<dd>List of direction steps of a route in the Google Maps Direction API Format.</dd>
</dl>
<h2 id="returns">Returns</h2>
<pre><code>    direction_steps (list): List of &lt;a title="farely_api.entity.DirectionStep" href="entity.html#farely_api.entity.DirectionStep"&gt;`DirectionStep`&lt;/a&gt; objects representing the steps of a route.
</code></pre></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_direction_steps(self, steps):
        &#34;&#34;&#34;Obtains a list of direction steps from a dictionary representing the steps.

        Args:
                steps (list): List of direction steps of a route in the Google Maps Direction API Format.

        ## Returns
                direction_steps (list): List of `farely_api.entity.DirectionStep` objects representing the steps of a route.
        &#34;&#34;&#34;
        direction_steps = []

        for step in steps:
                travel_mode = step[&#34;travel_mode&#34;]
                if travel_mode == &#34;TRANSIT&#34;:
                        direction_steps.append(self.get_transit_step(step))

                elif travel_mode == &#34;WALKING&#34;:
                        direction_steps.append(self.get_walking_step(step))

        return direction_steps</code></pre>
</details>
</dd>
<dt id="farely_api.control.FindRoutesController.get_transit_step"><code class="name flex">
<span>def <span class="ident">get_transit_step</span></span>(<span>self, step)</span>
</code></dt>
<dd>
<section class="desc"><p>Instantiates <a title="farely_api.entity.DirectionStep" href="entity.html#farely_api.entity.DirectionStep"><code>DirectionStep</code></a> from a walking step of a route.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>step</code></strong> :&ensp;<code>dict</code></dt>
<dd>Dictionary representing a walking step in the Google Maps Direction API Format.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>direction_step</code></strong> :&ensp;<a title="farely_api.entity.DirectionStep" href="entity.html#farely_api.entity.DirectionStep"><code>DirectionStep</code></a></dt>
<dd>A <a title="farely_api.entity.DirectionStep" href="entity.html#farely_api.entity.DirectionStep"><code>DirectionStep</code></a> object with attributes of the walking step.</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_transit_step(self, step):
        &#34;&#34;&#34;Instantiates `farely_api.entity.DirectionStep` from a walking step of a route.

        Args:
                step (dict): Dictionary representing a walking step in the Google Maps Direction API Format.

        Returns:
                direction_step (farely_api.entity.DirectionStep): A `farely_api.entity.DirectionStep` object with attributes of the walking step.
        &#34;&#34;&#34;
        line = step[&#34;transit_details&#34;][&#34;line&#34;][&#34;name&#34;]
        departure_stop = Location(
                **step[&#34;transit_details&#34;][&#34;departure_stop&#34;][&#34;location&#34;],
                name=step[&#34;transit_details&#34;][&#34;departure_stop&#34;][&#34;name&#34;],
        )
        arrival_stop = Location(
                **step[&#34;transit_details&#34;][&#34;arrival_stop&#34;][&#34;location&#34;],
                name=step[&#34;transit_details&#34;][&#34;arrival_stop&#34;][&#34;name&#34;],
        )
        distance = step[&#34;distance&#34;][&#34;value&#34;] / 1000

        travel_mode = None
        mode = step[&#34;transit_details&#34;][&#34;line&#34;][&#34;vehicle&#34;][&#34;type&#34;]

        if (mode == &#34;SUBWAY&#34;):
                travel_mode = TravelMode.MRT_LRT
        elif (mode == &#34;BUS&#34;):
                travel_mode = TravelMode.BUS

        return DirectionStep(
                line=line,
                travel_mode=travel_mode,
                arrival_stop=arrival_stop,
                departure_stop=departure_stop,
                distance=distance,
        )</code></pre>
</details>
</dd>
<dt id="farely_api.control.FindRoutesController.get_walking_step"><code class="name flex">
<span>def <span class="ident">get_walking_step</span></span>(<span>self, step)</span>
</code></dt>
<dd>
<section class="desc"><p>Instantiates <a title="farely_api.entity.DirectionStep" href="entity.html#farely_api.entity.DirectionStep"><code>DirectionStep</code></a> from a walking step of a route.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>step</code></strong> :&ensp;<code>dict</code></dt>
<dd>Dictionary representing a walking step in the Google Maps Direction API Format.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>direction_step</code></strong> :&ensp;<a title="farely_api.entity.DirectionStep" href="entity.html#farely_api.entity.DirectionStep"><code>DirectionStep</code></a></dt>
<dd>A <a title="farely_api.entity.DirectionStep" href="entity.html#farely_api.entity.DirectionStep"><code>DirectionStep</code></a> object with attributes of the walking step.</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_walking_step(self, step):
        &#34;&#34;&#34;Instantiates `farely_api.entity.DirectionStep` from a walking step of a route.

        Args:
                step (dict): Dictionary representing a walking step in the Google Maps Direction API Format.

        Returns:
                direction_step (farely_api.entity.DirectionStep): A `farely_api.entity.DirectionStep` object with attributes of the walking step.
        &#34;&#34;&#34;
        departure_stop = GoogleMapsService.get_location(**step[&#34;start_location&#34;])
        arrival_stop = GoogleMapsService.get_location(**step[&#34;end_location&#34;])
        distance = step[&#34;distance&#34;][&#34;value&#34;] / 1000

        return DirectionStep(
                travel_mode=TravelMode.WALK,
                arrival_stop=arrival_stop,
                departure_stop=departure_stop,
                distance=distance,
        )</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="farely_api" href="index.html">farely_api</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="farely_api.control.CardFareController" href="#farely_api.control.CardFareController">CardFareController</a></code></h4>
<ul class="">
<li><code><a title="farely_api.control.CardFareController.calculate_total_fare" href="#farely_api.control.CardFareController.calculate_total_fare">calculate_total_fare</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="farely_api.control.CashFareController" href="#farely_api.control.CashFareController">CashFareController</a></code></h4>
<ul class="">
<li><code><a title="farely_api.control.CashFareController.calculate_total_fare" href="#farely_api.control.CashFareController.calculate_total_fare">calculate_total_fare</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="farely_api.control.FareController" href="#farely_api.control.FareController">FareController</a></code></h4>
<ul class="">
<li><code><a title="farely_api.control.FareController.calculate_fare" href="#farely_api.control.FareController.calculate_fare">calculate_fare</a></code></li>
<li><code><a title="farely_api.control.FareController.calculate_total_fare" href="#farely_api.control.FareController.calculate_total_fare">calculate_total_fare</a></code></li>
<li><code><a title="farely_api.control.FareController.get_bus_type" href="#farely_api.control.FareController.get_bus_type">get_bus_type</a></code></li>
<li><code><a title="farely_api.control.FareController.get_step_fare" href="#farely_api.control.FareController.get_step_fare">get_step_fare</a></code></li>
<li><code><a title="farely_api.control.FareController.parse_steps" href="#farely_api.control.FareController.parse_steps">parse_steps</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="farely_api.control.FareControllerFactory" href="#farely_api.control.FareControllerFactory">FareControllerFactory</a></code></h4>
<ul class="">
<li><code><a title="farely_api.control.FareControllerFactory.get_fare_controller" href="#farely_api.control.FareControllerFactory.get_fare_controller">get_fare_controller</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="farely_api.control.FindRoutesController" href="#farely_api.control.FindRoutesController">FindRoutesController</a></code></h4>
<ul class="">
<li><code><a title="farely_api.control.FindRoutesController.add_route_details" href="#farely_api.control.FindRoutesController.add_route_details">add_route_details</a></code></li>
<li><code><a title="farely_api.control.FindRoutesController.find_routes" href="#farely_api.control.FindRoutesController.find_routes">find_routes</a></code></li>
<li><code><a title="farely_api.control.FindRoutesController.get_direction_steps" href="#farely_api.control.FindRoutesController.get_direction_steps">get_direction_steps</a></code></li>
<li><code><a title="farely_api.control.FindRoutesController.get_transit_step" href="#farely_api.control.FindRoutesController.get_transit_step">get_transit_step</a></code></li>
<li><code><a title="farely_api.control.FindRoutesController.get_walking_step" href="#farely_api.control.FindRoutesController.get_walking_step">get_walking_step</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.7.5</a>.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>